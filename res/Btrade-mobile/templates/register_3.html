<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>注册</title>
    <link rel="icon" href="favicon.ico">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/app.css">
</head>
<body class="yc-body-nofoot">
    <header class="yc-header">
        <div class="yc-header-back">
            <a href="javascript:history.back();">
                <i class="iconfont icon-back"></i>
            </a>
        </div>
        <div class="yc-header-title">注册</div>
        <div class="yc-header-right">
            <a href="login.html">已有账号，直接登录</a>
        </div>
    </header><!-- /yc-header -->

    <section class="yc-content">
        <div class="yc-guide">
            <ul>
                <li>
                    <span>1</span>
                    <strong>验证手机</strong>
                </li>
                <li><i class="iconfont icon-more"></i></li>
                <li>
                    <span>2</span>
                    <strong>填写基础信息</strong>
                </li>
                <li><i class="iconfont icon-more"></i></li>
                <li class="curr">
                    <span>3</span>
                    <strong>设置主营产品</strong>
                </li>
            </ul>
        </div>

        <div class="yc-breed">
            <div class="title">
                <span class="fr">添加后，为您推送对应采购单</span>
                <strong>添加主营品种</strong>
            </div>
            
            <div class="breeds">
                <ul id="jBreeds">
                    <!-- <li data-key="1120"><span>黄芪<i></i></span></li> -->
                </ul>
            </div>

            <div class="search">
                <input type="text" placeholder="在此输入品种名，例如“黄连”，点击出现的选项" class="keywords">
            </div>

            <div class="list"></div> 

            <div class="tips">
                还可以添加<b id="jTotal">6</b>个
            </div>

            <div class="button">
                <button class="submit" id="jSubmit" type="button">提交</button>
            </div>
        </div>


    </section><!-- /yc-content -->

    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/app.js"></script>
    <script>
    !(function($){
        var $breeds = $('#jBreeds');
        var $total = $('#jTotal');
        var maxNum = 6;
        var attentionArr = [];

        // 删除数组元素
        function arrRemoveVal(arr, val) {
            var i = 0;
            while(i < arr.length) {
                if(arr[i] === val) {
                    arr.splice(i, 1);
                    break;
                }
                i++;
            }
        }

        // 添加新品种
        $('.list').on('click', '.item', function() {
            var key = $(this).data('key');
            if ($.inArray(key, attentionArr) !== -1) {
                lpPopover('已关注“' + $(this).html() + '”品种', 5e3);

            } else if (attentionArr.length >= maxNum) {
                lpPopover('已超限，不能添加更多了', 5e3);

            } else {
                attentionArr.push(key);
                $breeds.append('<li data-key="' + key + '"><span>' + $(this).html() + '<i></i></span></li>');
                $('.search .keywords').val('');
                $total.html(maxNum - attentionArr.length);
            }
        });

        // 删除品种
        $breeds.on('click', 'i', function() {
            var key = $(this).closest('li').data('key') || '';
            arrRemoveVal(attentionArr, key);
            $(this).closest('li').remove();
            $total.html(maxNum - attentionArr.length);
        });

        // 搜索品种
        function getKeywords() {
            var keywords = $('.search .keywords').val();
            $.ajax({
                url: 'json/keywords.json',
                dataType: 'json',
                data: {key: keywords},
                success: function(data) {
                    if (data.status === 'success') {
                        toHtml(data.list, keywords);
                    } else {
                        $('.list').html(data.msg);
                    }
                },
                error: function() {
                    lpPopover('网络连接超时，请您稍后重试!');
                }
            })
        }
        function toHtml(json, keywords) {
            var html = [];
            $.each(json, function(i, v){
                html.push('<div class="item" data-key="' + v.number + '">' + v.name + '</div>');
            });
            $('.list').html(html.join(''));
        }
        var lazyAjax = debounce(getKeywords, 400);
        $('.search .keywords').on('input', lazyAjax);

        // 提交
        $('#jSubmit').on('click', function(){
            if (attentionArr.length === 0) {
                lpPopover('请添加主营品种', 5e3);

            }
        })



    }(jQuery));
    </script>
</body>
</html>